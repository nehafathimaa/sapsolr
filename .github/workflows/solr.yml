name: Install Solr 9 for SAP Commerce Cloud

on:
  workflow_dispatch:
env: 
  SOLR_VERSION: 9.5.0

jobs:
  build:
    runs-on: ubuntu-latest
 
    steps: 
      - name: Git checkout
        uses: actions/checkout@v4
        with: 
           fetch-depth: 1
           fetch-tags: true
 
      - name: Install Java 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
 
      - name: Download solr ${{ vars.SOLR_VERSION }} Package
        id: download_solr_pkg
        run: |
          echo "Downlading packages" 
          curl -s -O "https://archive.apache.org/dist/solr/solr/${{ env.SOLR_VERSION }}/solr-${{ env.SOLR_VERSION }}.tgz"
          ls -l
          tar xzf solr-${{ env.SOLR_VERSION }}.tgz 
          zip -r -qq solr-${{ env.SOLR_VERSION }}.zip solr-${{ env.SOLR_VERSION }}
 
      - name: Install Solr ${{ vars.SOLR_VERSION }}
        id: install_solr_pkg
        run: |
          echo "Install Solr ${{ env.SOLR_VERSION }}"
          mvn -v install:install-file -DgroupId=org.apache.solr -DartifactId=solr -Dversion=${{ env.SOLR_VERSION }} -Dpackaging=zip -Dfile=solr-${{ env.SOLR_VERSION }}.zip
          mvn dependency:tree
